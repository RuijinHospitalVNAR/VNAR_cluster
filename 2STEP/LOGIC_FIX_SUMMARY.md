# é€»è¾‘ä¿®å¤æ€»ç»“ - ç»Ÿä¸€Foldseekæ•°æ®åº“åˆ›å»º

## é—®é¢˜æè¿°

ç”¨æˆ·æŒ‡å‡ºè„šæœ¬é€»è¾‘å­˜åœ¨é—®é¢˜ï¼š**åº”è¯¥åœ¨æ‰¾åˆ°éœ€è¦è¿›è¡Œç²¾ç»†èšç±»çš„ç²—èšç±»ç»“æ„æ–‡ä»¶å¤¹åï¼Œå…ˆè¿›è¡Œfoldseekçš„æ•°æ®åº“è½¬åŒ–ï¼Œå†ç”¨foldseekæœåº“**ã€‚

## åŸé€»è¾‘çš„é—®é¢˜

### ğŸš¨ **é—®é¢˜1ï¼šé‡å¤çš„æ•°æ®åº“åˆ›å»º**
```python
# åŸé€»è¾‘ï¼šæ¯ä¸ªç²—èšç±»ç°‡éƒ½é‡å¤åˆ›å»ºæ•°æ®åº“
for cluster_idx, (coarse_cluster, cluster_size) in enumerate(sorted_clusters):
    if coarse_cluster in clusters_to_refine:
        # æ¯ä¸ªç°‡éƒ½é‡æ–°åˆ›å»ºFoldseekæ•°æ®åº“
        sparse_labels = self._foldseek_usalign_clustering(idx, k_neighbors, clustering_method, **kwargs)
```

**é—®é¢˜**ï¼š
- æ¯ä¸ªç²—èšç±»ç°‡éƒ½é‡æ–°å‡†å¤‡ç»“æ„æ–‡ä»¶
- æ¯ä¸ªç²—èšç±»ç°‡éƒ½é‡æ–°åˆ›å»ºFoldseekæ•°æ®åº“
- æ¯ä¸ªç²—èšç±»ç°‡éƒ½é‡æ–°è¿è¡ŒFoldseekæœç´¢
- æ•ˆç‡ä½ä¸‹ï¼Œå®¹æ˜“å‡ºé”™

### ğŸš¨ **é—®é¢˜2ï¼šèµ„æºæµªè´¹**
- é‡å¤çš„æ–‡ä»¶å¤åˆ¶æ“ä½œ
- é‡å¤çš„æ•°æ®åº“åˆ›å»º
- é‡å¤çš„æœç´¢è®¡ç®—
- ä¸´æ—¶æ–‡ä»¶ç®¡ç†å¤æ‚

## ä¿®å¤åçš„é€»è¾‘

### âœ… **ä¼˜åŒ–1ï¼šç»Ÿä¸€æ•°æ®åº“åˆ›å»º**
```python
# ä¿®å¤åï¼šä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰éœ€è¦ç²¾ç»†èšç±»çš„ç»“æ„åˆ›å»ºæ•°æ®åº“
# æ”¶é›†æ‰€æœ‰éœ€è¦ç²¾ç»†èšç±»çš„ç»“æ„ç´¢å¼•
all_refine_indices = []
for coarse_cluster, cluster_size in clusters_to_refine:
    if cluster_size <= max_cluster_size_for_refine and cluster_size >= 3:
        idx = [i for i, l in enumerate(self.coarse_labels) if l == coarse_cluster]
        all_refine_indices.extend(idx)

# ä¸€æ¬¡æ€§åˆ›å»ºFoldseekæ•°æ®åº“å’Œæœç´¢
if all_refine_indices:
    foldseek_results = self._create_unified_foldseek_search(all_refine_indices, k_neighbors, **kwargs)
```

### âœ… **ä¼˜åŒ–2ï¼šå¤ç”¨æœç´¢ç»“æœ**
```python
# ä¿®å¤åï¼šå¤ç”¨é¢„è®¡ç®—çš„Foldseekç»“æœ
for cluster_idx, (coarse_cluster, cluster_size) in enumerate(sorted_clusters):
    if coarse_cluster in clusters_to_refine:
        # ä½¿ç”¨ç»Ÿä¸€çš„Foldseekç»“æœè¿›è¡Œèšç±»
        if foldseek_results is not None:
            sparse_labels = self._foldseek_usalign_clustering_with_results(idx, foldseek_results, clustering_method, **kwargs)
        else:
            # å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨åŸæ¥çš„æ–¹æ³•
            sparse_labels = self._foldseek_usalign_clustering(idx, k_neighbors, clustering_method, **kwargs)
```

## æ–°å¢æ–¹æ³•

### 1. `_create_unified_foldseek_search()`
- ä¸ºæ‰€æœ‰éœ€è¦ç²¾ç»†èšç±»çš„ç»“æ„åˆ›å»ºç»Ÿä¸€çš„Foldseekæ•°æ®åº“
- ä¸€æ¬¡æ€§è¿è¡ŒFoldseekæœç´¢
- è¿”å›è§£æåçš„æœç´¢ç»“æœ

### 2. `_parse_unified_foldseek_results()`
- è§£æç»Ÿä¸€çš„Foldseekæœç´¢ç»“æœ
- å»ºç«‹å…¨å±€ç´¢å¼•åˆ°å±€éƒ¨ç´¢å¼•çš„æ˜ å°„
- è¿”å›æ¯ä¸ªç»“æ„çš„é‚»å±…ä¿¡æ¯

### 3. `_foldseek_usalign_clustering_with_results()`
- ä½¿ç”¨é¢„è®¡ç®—çš„Foldseekç»“æœè¿›è¡Œèšç±»
- é¿å…é‡å¤çš„æ•°æ®åº“åˆ›å»ºå’Œæœç´¢
- ä¿æŒä¸åŸæœ‰æ–¹æ³•çš„å…¼å®¹æ€§

### 4. `_extract_neighbor_matrix_from_results()`
- ä»é¢„è®¡ç®—çš„Foldseekç»“æœä¸­æå–é‚»å±…çŸ©é˜µ
- å¤„ç†ç´¢å¼•æ˜ å°„
- æ„å»ºç¨€ç–é‚»å±…çŸ©é˜µ

## ä¼˜åŠ¿

### ğŸš€ **æ€§èƒ½æå‡**
- **å‡å°‘æ•°æ®åº“åˆ›å»ºæ¬¡æ•°**ï¼šä»Næ¬¡ï¼ˆNä¸ªç°‡ï¼‰å‡å°‘åˆ°1æ¬¡
- **å‡å°‘æ–‡ä»¶å¤åˆ¶æ“ä½œ**ï¼šé¿å…é‡å¤çš„æ–‡ä»¶å‡†å¤‡
- **å‡å°‘æœç´¢è®¡ç®—**ï¼šä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰æœç´¢

### ğŸ›¡ï¸ **ç¨³å®šæ€§æå‡**
- **å‡å°‘é”™è¯¯æ¦‚ç‡**ï¼šé¿å…é‡å¤çš„æ•°æ®åº“åˆ›å»ºå¤±è´¥
- **ç®€åŒ–é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†é€»è¾‘
- **æ›´å¥½çš„èµ„æºç®¡ç†**ï¼šç»Ÿä¸€çš„ä¸´æ—¶æ–‡ä»¶ç®¡ç†

### ğŸ”§ **ç»´æŠ¤æ€§æå‡**
- **ä»£ç æ›´æ¸…æ™°**ï¼šé€»è¾‘åˆ†ç¦»ï¼ŒèŒè´£æ˜ç¡®
- **æ˜“äºè°ƒè¯•**ï¼šç»Ÿä¸€çš„æ—¥å¿—è¾“å‡º
- **å‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰æ–¹æ³•ä½œä¸ºå¤‡ç”¨

## å·¥ä½œæµç¨‹å¯¹æ¯”

### **ä¿®å¤å‰**ï¼š
```
ç²—èšç±»ç»“æœ â†’ éå†æ¯ä¸ªç°‡ â†’ å‡†å¤‡æ–‡ä»¶ â†’ åˆ›å»ºæ•°æ®åº“ â†’ æœç´¢ â†’ è§£æ â†’ èšç±»
                â†“
            é‡å¤Næ¬¡ï¼ˆNä¸ªç°‡ï¼‰
```

### **ä¿®å¤å**ï¼š
```
ç²—èšç±»ç»“æœ â†’ æ”¶é›†æ‰€æœ‰éœ€è¦ç²¾ç»†èšç±»çš„ç»“æ„ â†’ ä¸€æ¬¡æ€§å‡†å¤‡æ–‡ä»¶ â†’ åˆ›å»ºç»Ÿä¸€æ•°æ®åº“ â†’ ç»Ÿä¸€æœç´¢ â†’ è§£æ â†’ åˆ†åˆ«èšç±»
```

## é¢„æœŸæ•ˆæœ

1. **æ€§èƒ½æå‡**ï¼šå‡å°‘50-80%çš„Foldseekç›¸å…³æ“ä½œæ—¶é—´
2. **ç¨³å®šæ€§æå‡**ï¼šå‡å°‘æ•°æ®åº“åˆ›å»ºå¤±è´¥çš„æ¦‚ç‡
3. **èµ„æºä¼˜åŒ–**ï¼šå‡å°‘ä¸´æ—¶æ–‡ä»¶çš„ä½¿ç”¨å’Œç£ç›˜I/O
4. **é€»è¾‘æ¸…æ™°**ï¼šç¬¦åˆç”¨æˆ·æœŸæœ›çš„å·¥ä½œæµç¨‹

## æµ‹è¯•å»ºè®®

1. **åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯ä¿®å¤åçš„é€»è¾‘ä¸åŸæœ‰é€»è¾‘ç»“æœä¸€è‡´
2. **æ€§èƒ½æµ‹è¯•**ï¼šæ¯”è¾ƒä¿®å¤å‰åçš„æ‰§è¡Œæ—¶é—´
3. **ç¨³å®šæ€§æµ‹è¯•**ï¼šæµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
4. **å…¼å®¹æ€§æµ‹è¯•**ï¼šç¡®ä¿å¤‡ç”¨æ–¹æ¡ˆæ­£å¸¸å·¥ä½œ
